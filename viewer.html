<head>
<script src="./jquery.min.js"></script>
<script>
$(document).on("ready",function(){
  var rebuild = function(){
    var classes = $("#list").attr("class");
    $("#list").removeAttr("class");
    setTimeout(function(){
      $("#list").attr("class",classes);
      detectStart();
      window.scrollTo(XStart,YStart);
    },50);
  }
  var scroll = function(){
    window.scrollTo(window.pageXOffset-speed,window.pageYOffset);
    if(XOffset === window.pageXOffset){
      window.scrollTo(XStart,window.pageYOffset);
    }
    XOffset = window.pageXOffset;
    window.scrollTo(window.pageXOffset,window.pageYOffset+speed);
    if(YOffset === window.pageYOffset){
      window.scrollTo(window.pageXOffset,YStart);
    }
    YOffset = window.pageYOffset;
  }
  var detectStart = function(){
    if(speed > 0){
      XStart = $(document).outerWidth() - $(window).width();
      YStart = 0;
    }
    if(speed < 0){
      XStart = 0;
      YStart = $(document).outerHeight() - window.screen.availHeight;
    }
  }

  var autoscroll = -1;
  var speed = 5;
  var XOffset = window.pageXOffset;
  var YOffset = window.pageYOffset;
  var XStart = $(document).outerWidth() - $(window).width();
  var YStart = 0;
  var scrollSpeed = 16;
  setInterval(function(){
    if(autoscroll > 0){
      scroll();
    }
  },scrollSpeed);

  $("#dir").on("change",function(e){
    if(e.target.files.length){
      $("#list").empty();
      function compare(a,b) {
        if (a.name < b.name)
          return -1;
        else if (a.name > b.name)
          return 1;
        else 
          return 0;
      }
      var files = [];
      for(i=0;i<e.target.files.length;i++){
        files.push(e.target.files[i]);
      }

      files.sort(compare);
      var loading = false;
      var me = setInterval(function(){
        if(!loading){
          loading = true;
          var f = files.shift();
          if(f.type.match('image.*')){
            var reader = new FileReader();
            reader.onload = (function(theFile) {
              console.log(theFile);
              return function(e) {
                $("#list").append('<div class="item"><img src="'+e.target.result+'"></div>')
                loading = false;
                if(!files.length){
                  clearInterval(me);
                  rebuild();
                }
              };
            })(f);
            reader.readAsDataURL(f);
          }else{
            loading = false;
            if(!files.length){
              clearInterval(me);
              rebuild();
            }
          }
        }
      },0);
    }
  });

  $(document).on("keypress",function(e){
    //space
    if(e.which == 32){
      autoscroll *= -1;
    }
    //r
    if(e.which == 114){
      speed *= -1;
    }
    //h
    if(e.which == 104){
      $("#list").attr("class","horizonal");
      
    }
    //v
    if(e.which == 118){
      $("#list").attr("class","vertical");
    }

    //m
    if(e.which == 109){
      $("#list").toggleClass("spread");
    }

    //plus
    if(e.which == 43){
      speed = Math.abs(speed+1)*(speed/Math.abs(speed)) || 1;
    }
    //substruct
    if(e.which == 45){
      speed = Math.abs(speed-1)*(speed/Math.abs(speed)) || 1;
    }

    detectStart();
  });

  $(window).on("resize",function(){
    rebuild();
  });
});
</script>
<style>
* {
  margin:0;
  padding:0;
}
body {
  overflow:hidden;
  background:#cccccc;
}
#menu {
  background:rgba(255,255,255,0.5);
  text-align:right;
  width:100%;
  position:fixed;
  bottom:0;
  right:0;
  opacity:0;
}
#menu:hover {
  opacity:1;
}


#list.vertical {
  width:100%;
  display:inline-flex;
  flex-direction:row;
  flex-wrap:wrap;
  align-items:center;
}

#list.horizonal {
  display:inline-flex;
  flex-direction:row-reverse;
  flex-wrap:no-wrap;
}

#list > .item {
  width:100%;
}

#list.vertical.spread > .item {
  width:50%;
}

.horizonal img {
  height:100%;
}

.vertical img {
  width:100%;
}


</style>
</head>
<body>
<section id="menu">
  <input id="dir" type="file" directory webkitdirectory>
</section>
<section id="list" class="vertical spread">
</section>
</body>